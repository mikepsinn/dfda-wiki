# Get list of staged markdown, JSON, and template files
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(md|json|njk)$' || true)

if [ -z "$STAGED_FILES" ]; then
  exit 0
fi

FILE_COUNT=$(echo "$STAGED_FILES" | wc -l | tr -d ' ')
echo "üîç Validating links in $FILE_COUNT staged file(s)..."
echo ""

# Convert newline-separated files to space-separated for npm script
FILES_ARGS=$(echo "$STAGED_FILES" | tr '\n' ' ')

# Run validation - script handles all output and exits with code 1 on errors
npx tsx scripts/validate-links-and-images.ts $FILES_ARGS
